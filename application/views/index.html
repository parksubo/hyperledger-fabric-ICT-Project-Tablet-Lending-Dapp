<head>
    <!-- Bootstrap include -->
    <link
        rel="stylesheet"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
        crossorigin="anonymous"
    />

    <!-- fontawsome -->
    <link
        rel="stylesheet"
        href="https://use.fontawesome.com/releases/v5.9.0/css/all.css"
    />

    <!-- jquery 버전 유의 -->
    <!-- slim/jquery, 3.1.0 윗 버전에서 ajax가 작동하지 않는 오류 확인 -->
    <!-- Bootstrap의 CDN을 copy&paste 하되 Line 8의 버전만 3.1.0으로 수정하세요 -->
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</head>

<body>
    <div class="container">
        <img src = https://images.samsung.com/kdp/goods/2022/01/28/9268d7de-044d-442b-bf4e-4f9d39c14444.png?$PD_GALLERY_L_PNG$
        width="320", height="180">
        <h1>Tablet Lend Dapp</h1>
        <hr />

        <div class="container text-center">
            <div class="row g-2">
              <div class="col-6">
                <div class="p-3 border bg-light">
                    <div class="row justify-content-md-center">
                        <div class="col-lg">
                            <div id="new-alert"></div>
                            <h3>새 유저를 추가합니다</h3>
                            <input
                                type="text"
                                id="new-email"
                                name="email"
                                placeholder="새로 추가할 유저의 이메일을 입력하세요"
                            />
                            <br />
                            <button class="btn btn-warning" id="new-btn">추가하기</button>
                        </div>
                    </div>
                    <table class="table">
                        <tbody id="table2"></tbody>
                    </table>
                </div>
              </div>
              <div class="col-6">
                <div class="p-3 border bg-light">        
                    <div class="row justify-content-md-center">
                        <div class="col-lg">
                            <div id="find-alert"></div>
                            <h3>이메일로 유저 조회</h3>
                            <input
                                type="text"
                                id="find-email"
                                name="email"
                                placeholder="조회할 이메일을 입력하세요"
                            />
                            <br />
                            <button class="btn btn-warning" id="find-btn">조회하기</button>
            
                        </div>
                    </div>
                    <!-- 테이블 안에 row를 하나씩 붙이는 곳 -->
                    <table class="table">
                        <tbody id="table"></tbody>
                    </table>
                </div>
              </div>

              <div class="col-6">
                <div class="p-3 border bg-light">        
                    <div class="row justify-content-md-center">
                        <div class="col-lg">
                            <div id="add-alert"></div>
                            <h3>태블릿 대여</h3>
                            <input
                                type="text"
                                id="add-email"
                                name="email"
                                placeholder="이메일 입력"
                            />
                            <br />
                            <input
                                type="text"
                                id="add-tablet"
                                name="tablet"
                                placeholder="테블릿 모델 입력"
                            />
                            <br />
                            <input
                                type="text"
                                id="add-record"
                                name="record"
                                placeholder="날짜 입력"
                            />
                            <br />
                            <button class="btn btn-primary" id="add-btn">대여하기</button>
                        </div>
                    </div>
                </div>
              </div>

              <div class="col-6">
                <div class="p-3 border bg-light">        
                    <div class="row justify-content-md-center">
                        <div class="col-lg">
                            <div id="return-alert"></div>
                            <h3>태블릿 반납</h3>
                            <input
                                type="text"
                                id="return-email"
                                name="email"
                                placeholder="이메일 입력"
                            />
                            <br />
                            <input
                                type="text"
                                id="return-tablet"
                                name="tablet"
                                placeholder="테블릿 모델 입력"
                            />
                            <br />
                            <input
                                type="text"
                                id="return-record"
                                name="record"
                                placeholder="날짜 입력"
                            />
                            <br />
                            <button class="btn btn-primary" id="return-btn">반납하기</button>
                        </div>
                    </div>
                </div>
              </div>
            </div>
          </div>
        </div>
</body>

<script>
    // 유저추가
    $("#new-btn").click(() => {
        // new-email이라는 id값을 가지고 있는 input의 value를 가지고 옴
        const value = $("#new-email").val();
        const url = "/mate";

        // email이라는 파라메터에 위의 value를 넣음
        $.post(url, { email: value }, (data, status) => {
            // http 상태 코드가 200(success)이라면
            if (status == "success") {
                // 성공했다는 alert창을 띄움
                $("#new-alert").append(
                    "<div id='success' class='alert alert-success'>추가를 성공했습니다!</div>"
                );
                $("#new-alert").fadeOut(4000);
            }
        });
    });
    // 태블릿 대여
    $("#add-btn").click(() => {
        // new-email이라는 id값을 가지고 있는 input의 value를 가지고 옴
        const e = $("#add-email").val();
        const t = $("#add-tablet").val();
        const r = $("#add-record").val();

        const url = "/record";

        // email이라는 파라메터에 위의 value를 넣음
        $.post(url, { email: e, tablet: t, record: r }, (data, status) => {
            // http 상태 코드가 200(success)이라면
            if (status == "success") {
                // 성공했다는 alert창을 띄움
                $("#add-alert").append(
                    "<div id='success' class='alert alert-success'>대여 성공!</div>"
                );
                $("#add-alert").fadeOut(4000);
            }
        });
    });
    // 태블릿 반납
    $("#return-btn").click(() => {
        // new-email이라는 id값을 가지고 있는 input의 value를 가지고 옴
        const e = $("#return-email").val();
        const t = $("#return-tablet").val() + "(returned)";
        const r = $("#return-record").val();
        
        const url = "/return";

        // email이라는 파라메터에 위의 value를 넣음
        $.post(url, { email: e, tablet: t, record: r }, (data, status) => {
            // http 상태 코드가 200(success)이라면
            if (status == "success") {
                // 성공했다는 alert창을 띄움
                $("#return-alert").append(
                    "<div id='success' class='alert alert-success'>반납 성공!</div>"
                );
                $("#return-alert").fadeOut(4000);
            }
        });
    });

    $("#find-btn").click(() => {
        const value = $("#find-email").val();
        const url = "/mate/" + value;
        $.post(url, { email: value }, (data) => {
            // 조회했을 때 값이 null이 아니면 (일치하는 값이 존재한다면)
            if (status != null) {
                $("#find-alert").append(
                    "<div id='success' class='alert alert-success'>조회 성공!</div>"
                );
                $("#find-alert").fadeOut(2000);

                // stringify는 json객체를 string으로, parse는 string을 json객체로 변환 시켜줌
                const test = JSON.stringify(data);
                const parsedData = JSON.parse(test);
                $("#table").empty();

                $("#table").append(
                    "<tr><th scope='row'>isLend</th><td>" +
                        parsedData.islend +
                        "</td></tr>"
                );
                // rates라는 key의 value로 Json array가 있으므로 반복문을 통해 한 줄씩 테이블에 넣어줌
                for (var i = 0; i < parsedData.dates.length; i++) {
                    $("#table").append(
                        "<tr><th scope='row'>Tablet</th><td>" +
                            parsedData.dates[i].tablet +
                            "</td></tr>"
                    );
                    $("#table").append(
                        "<tr><th scope='row'>record</th><td>" +
                            parsedData.dates[i].record +
                            "</td></tr>"
                    );
                }
            }
        });
    });
</script>

<!-- styling -->
<style>
    .container {
        width: 100%;
        height: 500px;
        margin: 50px 50px;
        padding: 20px 20px;
        text-align: center;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
    }

    button {
        margin: 20px 10px;
    }

    input {
        width: 300px;
        padding: 10px 8px;
    }

    .col-6 {
        padding: 20px 10px;
    }
</style>
